<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My profile — Serenest</title>
<link rel="stylesheet" href="premium.css">
<script src="config.js"></script>
<style>
.profile-page{min-height:100vh;padding:100px 60px 80px;max-width:560px;margin:0 auto;}
.profile-page h1{font-family:'Cormorant Garamond',serif;font-size:2rem;font-weight:300;color:var(--dark);margin-bottom:8px;}
.profile-page .sub{font-size:0.9rem;color:var(--text-light);margin-bottom:32px;}
.profile-section{background:var(--white);border:1.5px solid var(--cream-dark);border-radius:16px;padding:28px;margin-bottom:24px;}
.profile-section h2{font-size:1rem;font-weight:600;color:var(--dark);margin-bottom:20px;}
.profile-section label{display:block;font-size:0.75rem;font-weight:500;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-light);margin-bottom:8px;}
.profile-section input{width:100%;padding:12px 16px;border:1.5px solid var(--cream-dark);border-radius:12px;font-family:inherit;margin-bottom:16px;}
.profile-section input:focus{outline:none;border-color:var(--sage);}
.profile-section input:disabled{background:var(--cream);color:var(--text-light);}
.btn{display:inline-block;padding:12px 24px;background:var(--sage);color:var(--white);border:none;border-radius:12px;font-family:inherit;font-size:0.9rem;font-weight:500;cursor:pointer;}
.btn:hover{background:var(--sage-dark);}
.btn-secondary{background:transparent;color:var(--text-light);border:1px solid var(--cream-dark);}
.btn-secondary:hover{background:var(--cream);}
.profile-msg{font-size:0.85rem;margin-top:12px;display:none;}
.profile-msg.ok{color:var(--sage-dark);}
.profile-msg.err{color:#c0392b;}
nav{padding:20px 60px;display:flex;align-items:center;justify-content:space-between;background:rgba(247,245,240,0.88);border-bottom:1px solid rgba(125,155,118,0.15);}
.logo{font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:600;color:var(--dark);text-decoration:none;}.logo span{color:var(--sage);}
nav a{text-decoration:none;font-size:0.9rem;color:var(--text-light);margin-left:16px;}
nav a:hover{color:var(--sage-dark);}
@media(max-width:900px){.profile-page{padding:80px 24px 60px;} nav{padding:16px 24px;} nav a{margin-left:10px;}}
</style>
</head>
<body>
<nav>
  <a href="index.html" class="logo">Sere<span>nest</span></a>
  <div>
    <a href="book.html">Book</a>
    <a href="dashboard.html">My bookings</a>
    <a href="profile.html">Profile</a>
    <a href="#" id="logoutLink">Log out</a>
  </div>
</nav>
<div class="profile-page">
  <h1>My profile</h1>
  <p class="sub">Manage your account details.</p>

  <div class="profile-section">
    <h2>Account details</h2>
    <label>Email</label>
    <input type="email" id="profileEmail" disabled placeholder="Loading…">
    <label>Full name</label>
    <input type="text" id="profileName" placeholder="Your name">
    <button type="button" id="saveProfileBtn" class="btn">Save name</button>
    <p id="profileMsg" class="profile-msg"></p>
  </div>

  <div class="profile-section">
    <h2>Change password</h2>
    <label>Current password</label>
    <input type="password" id="currentPassword" placeholder="Enter current password">
    <label>New password (min 8 characters)</label>
    <input type="password" id="newPassword" placeholder="New password">
    <label>Confirm new password</label>
    <input type="password" id="confirmPassword" placeholder="Confirm new password">
    <button type="button" id="changePwBtn" class="btn btn-secondary">Change password</button>
    <p id="passwordMsg" class="profile-msg"></p>
  </div>
</div>
<script>
(function(){
  var TOKEN_KEY='serenest_patient_token';
  var API=(window.API_BASE||'')+'/api';
  var token=localStorage.getItem(TOKEN_KEY);
  if(!token){ window.location.href='login.html'; return; }
  var headers={'X-Patient-Token':token,'Content-Type':'application/json'};

  document.getElementById('logoutLink').addEventListener('click',function(e){ e.preventDefault(); localStorage.removeItem(TOKEN_KEY); window.location.href='index.html'; });

  function showMsg(el,text,isErr){ var m=document.getElementById(el); m.textContent=text; m.className='profile-msg '+(isErr?'err':'ok'); m.style.display='block'; }
  function hideMsg(el){ document.getElementById(el).style.display='none'; }

  fetch(API+'/me',{headers:headers})
    .then(function(r){ if(r.status===401){ localStorage.removeItem(TOKEN_KEY); window.location.href='login.html'; return null; } return r.json(); })
    .then(function(d){
      if(!d||!d.ok) return;
      document.getElementById('profileEmail').value=d.patient.email||'';
      document.getElementById('profileName').value=d.patient.full_name||'';
    })
    .catch(function(){ showMsg('profileMsg','Could not load profile.',true); });

  document.getElementById('saveProfileBtn').addEventListener('click',function(){
    hideMsg('profileMsg');
    var name=document.getElementById('profileName').value.trim();
    fetch(API+'/me',{method:'PUT',headers:headers,body:JSON.stringify({full_name:name})})
      .then(function(r){ return r.json(); })
      .then(function(d){
        if(d&&d.ok){ showMsg('profileMsg','Saved.'); }
        else{ showMsg('profileMsg',d&&d.error?d.error:'Failed.',true); }
      })
      .catch(function(){ showMsg('profileMsg','Network error.',true); });
  });

  document.getElementById('changePwBtn').addEventListener('click',function(){
    hideMsg('passwordMsg');
    var cur=document.getElementById('currentPassword').value;
    var newP=document.getElementById('newPassword').value;
    var conf=document.getElementById('confirmPassword').value;
    if(!cur){ showMsg('passwordMsg','Enter current password.',true); return; }
    if(newP.length<8){ showMsg('passwordMsg','New password must be at least 8 characters.',true); return; }
    if(newP!==conf){ showMsg('passwordMsg','New passwords do not match.',true); return; }
    fetch(API+'/me/change-password',{method:'POST',headers:headers,body:JSON.stringify({current_password:cur,new_password:newP})})
      .then(function(r){ return r.json(); })
      .then(function(d){
        if(d&&d.ok){
          showMsg('passwordMsg','Password updated.');
          document.getElementById('currentPassword').value='';
          document.getElementById('newPassword').value='';
          document.getElementById('confirmPassword').value='';
        }
        else{ showMsg('passwordMsg',d&&d.error?d.error:'Failed.',true); }
      })
      .catch(function(){ showMsg('passwordMsg','Network error.',true); });
  });
})();
</script>
<script src="premium.js"></script>
<script src="scripts/dark-mode.js"></script>
<script src="scripts/whatsapp-float.js"></script>
</body>
</html>
